version: '3.8'

services:
  autoscaler:
    image: crimeisdown/trunk-transcribe:${VERSION:-main}
    build:
      context: .
      dockerfile: Dockerfile
    command:
      - ./autoscale-vast.py
      - --min-instances
      - ${AUTOSCALE_MIN_INSTANCES:-1}
      - --max-instances
      - ${AUTOSCALE_MAX_INSTANCES:-10}
      - --throughput
      - ${AUTOSCALE_THROUGHPUT:-20}
    environment:
      - VAST_API_KEY
    volumes:
      - ./bin/autoscale-vast.py:/src/autoscale-vast.py
      - ./.env.vast:/src/.env.vast
      - ~/.vast_api_key:/root/.vast_api_key
    restart: always
