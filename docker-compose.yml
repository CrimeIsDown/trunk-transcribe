version: '3.8'

services:

  web:
    image: crimeisdown/trunk-transcribe:main-medium.en
    build: .
    ports:
      - 8000:8000
    command: web
    volumes:
      - ./app:/src/app
      - ./config:/src/config
      - ./docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh
    env_file: .env

  worker:
    image: crimeisdown/trunk-transcribe:main-medium.en
    build: .
    command: worker
    volumes:
      - ./app:/src/app
      - ./config:/src/config
      - ./docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh
    env_file: .env

  dashboard:
    image: crimeisdown/trunk-transcribe:main-medium.en
    build: .
    command: flower
    volumes:
      - ./flowerconfig.py:/src/flowerconfig.py
      - ./docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh
      - flowerdb:/src/data
    ports:
      - 5555:5555
    env_file: .env

  broker:
    image: rabbitmq:3-management
    ports:
      - 5672:5672
      - 15672:15672
    env_file: .env

volumes:
  flowerdb:
